<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Upload to Community Gallery</title>
  <!-- Pull in your global stylesheet for colors, typography, etc. -->
  <link rel="stylesheet" href="style.css" />

  <style>
    /* Layout & spacing only—colors come from style.css */
    body {
      font-family: sans-serif;
      margin: 1rem;
    }
    .info-message {
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 1rem;
    }
    form {
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 1rem;
    }
    form label {
      display: block;
      margin-bottom: 0.75rem;
      font-weight: bold;
    }
    input, textarea {
      width: 100%;
      padding: 0.6rem;
      border-radius: 4px;
      margin-top: 0.25rem;
      border: 1px solid var(--border-color);
      background-color: var(--input-bg);
      color: var(--text-primary);
    }
    textarea {
      min-height: 120px;
      resize: vertical;
    }
    #uploadBtn {
      padding: 0.6rem 1.2rem;
      font-size: 1rem;
      border-radius: 4px;
      cursor: pointer;
      border: none;
      background-color: var(--color-primary);
      color: var(--on-primary);
    }
    #uploadBtn:hover {
      background-color: var(--color-primary-dark);
    }
    #uploadStatus {
      margin-top: 1rem;
      font-weight: bold;
      color: var(--text-secondary);
    }
  </style>
</head>
<body>
  <!-- Info message -->
  <div class="info-message">
    <p>
      Welcome to the Community Transit Gallery! Submit your best Moon and Sun transit photos along with the story behind them to inspire fellow enthusiasts. 
      Once you upload, our team will review your submission—approved images will appear in the public gallery within a few hours. 
      Submissions must be strictly transit-related; inappropriate or off-topic images will be declined. 
      Please keep each file under 10 MB.
    </p>
  </div>

  <h1>Upload Your Photo</h1>

  <!-- Metadata form -->
  <form id="metaForm">
    <label for="title">Title
      <input type="text" id="title" placeholder="Short description">
    </label>
    <label for="dateTaken">Date Taken
      <input type="date" id="dateTaken">
    </label>
    <label for="location">Location
      <input type="text" id="location" placeholder="City, venue, etc.">
    </label>
    <label for="equipment">Equipment
      <input type="text" id="equipment" placeholder="Camera / lens">
    </label>
    <label for="description">Description
      <textarea id="description" placeholder="Tell us more about your photo…"></textarea>
    </label>
  </form>

  <button id="uploadBtn">📤 Upload Photo</button>
  <div id="uploadStatus"></div>

  <!-- Cloudinary widget -->
  <script src="https://widget.cloudinary.com/v2.0/global/all.js"></script>

  <!-- Firebase (modular v11) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
    import {
      getFirestore,
      collection,
      addDoc,
      serverTimestamp
    } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBnPNWITBW92erbxYKLxJaj-s85c1xoiGU",
      authDomain: "transits-9c696.firebaseapp.com",
      projectId: "transits-9c696",
      storageBucket: "transits-9c696.firebasestorage.app",
      messagingSenderId: "83794226858",
      appId: "1:83794226858:web:2cb7f6a8e8f05bd699ead3",
      measurementId: "G-88JRQSFZG5"
    };
    const app = initializeApp(firebaseConfig);
    const db  = getFirestore(app);

    const widget = cloudinary.createUploadWidget({
      cloudName: 'dotbgstrs',
      uploadPreset: 'Transits'
    }, (err, result) => {
      const statusEl = document.getElementById('uploadStatus');
      if (err) {
        statusEl.textContent = 'Upload error—please check the console.';
        console.error(err);
        return;
      }
      if (result.event === 'success') {
        const url = result.info.secure_url;
        const title       = document.getElementById('title').value;
        const dateTaken   = document.getElementById('dateTaken').value;
        const location    = document.getElementById('location').value;
        const equipment   = document.getElementById('equipment').value;
        const description = document.getElementById('description').value;

        addDoc(collection(db, 'gallery'), {
          url,
          uploadedAt:  serverTimestamp(),
          title,
          dateTaken,
          location,
          equipment,
          description,
          status:      'pending'
        })
        .then(() => {
          statusEl.textContent = '✅ Uploaded and pending approval!';
        })
        .catch(e => {
          statusEl.textContent = '❌ Error saving data.';
          console.error(e);
        });
      }
    });

    document.getElementById('uploadBtn')
      .addEventListener('click', () => widget.open());
  </script>
</body>
</html>
